# nginx_lu学习笔记
### 1.概述
    nginx是高性能、支持并发的高性能web服务请，以模块的形式提供各种服务。
    nginx的修改西需要用C开发，成本高，因此有了nginx_lua模块
    ngx_lua将lua解释器集成到nginx，采用lua脚本实现业务逻辑，可以降低成本。
### 2. nginx的特性

- 单一master-多worker
- 每个阶段都会注册handler，同时每一个配置指令只会注册在某个特定的阶段运行。
- 子请求（nginx内部的级联请求）
    “子请求”方式的通信是在同一个虚拟主机内部进行的，所以 Nginx 核心在实现“子请求”的时候，就只调用了若干个 C 函数，完全不涉及任何网络或者 UNIX 套接字（socket）通信。我们由此可以看出“子请求”的执行效率是极高的。
- 协程（contuine）
    协程类似一种多线程，与多线程的区别有：
    1. 协程并非os线程，所以创建、切换开销比线程相对要小。
    2. 协程与线程一样有自己的栈、局部变量等，但是协程的栈是在用户进程空间模拟的，所以创建、切换开销很小。
    3. 多线程程序是多个线程并发执行，也就是说在一瞬间有多个控制流在执行。而协程强调的是一种多个协程间协作的关系，只有当一个协程主动放弃执行权，另一个协程才能获得执行权，所以在某一瞬间，多个协程间只有一个在运行。
    4. 由于多个协程时只有一个在运行，所以对于临界区的访问不需要加锁，而多线程的情况则必须加锁。
    5. 多线程程序由于有多个控制流，所以程序的行为不可控，而多个协程的执行是由开发者定义的所以是可控的。
    Nginx的每个Worker进程都是在epoll或kqueue这样的事件模型之上，封装成协程，每个请求都有一个协程进行处理。这正好与Lua内建协程的模型是一致的，所以即使ngx_lua需要执行Lua，相对C有一定的开销，但依然能保证高并发能力。
### 3.nginx_lua

